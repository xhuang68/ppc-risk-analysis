<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title></title>

    <!-- import Bootstrap css -->
    <link rel="stylesheet" href="./static/css/bootstrap.min.css">

    <!-- import jQuery & jQuery-contextMenu -->
    <script src="./static/plugins/jquery-1.11.3/jquery.min.js"></script>

    <!-- import Bootstrap js -->
    <script src="./static/js/bootstrap.min.js"></script>

</head>

<body>
    <div id="info-wrapper" style="height:512px;width:768px;margin:0 auto;border:1px solid #999999;overflow:scroll;">

      <div class="info-header" style="width:768px;height:40px;line-height:40px;padding-left:20px;background:rgba(153, 204, 255, 0.8);position:fixed;z-index:2;">
        <p style="display:inline-block;font-weight:bolder;">条目 1</p>
        <button class="btn btn-default btn-sm" type="button" name="button" onclick="handleReturn()" style="float:right;margin-top:5px;margin-right:20px;">返回</button>
        <button class="btn btn-default btn-sm" type="button" name="button" onclick="handleDelete()" style="float:right;margin-top:5px;margin-right:10px;">删除</button>
        <button class="btn btn-default btn-sm" type="button" name="button" onclick="handleSubmit()" style="float:right;margin-top:5px;margin-right:10px;">提交</button>
      </div>

      <div class="info-content" style="margin-top:60px;padding:0 20px;">
        <form class="form-horizontal" id="analysis-form">
            <div class="form-group">
                <label for="analysis-form-function" class="col-sm-2 control-label">预期功能/标准</label>
                <div class="col-sm-10">
                    <textarea class="form-control" rows="3" name="function" id="analysis-form-function" placeholder="预期功能/标准" style="resize:vertical;"></textarea>
                </div>
            </div>
            <div class="form-group">
                <label for="analysis-form-error" class="col-sm-2 control-label">故障模式及原因</label>
                <div class="col-sm-10">
                  <textarea class="form-control" rows="3" name="error" id="analysis-form-error" placeholder="故障模式及原因" style="resize:vertical;"></textarea>
                </div>
            </div>
            <div class="form-group">
                <label for="analysis-form-impact" class="col-sm-2 control-label">故障影响</label>
                <div class="col-sm-10">
                    <textarea class="form-control" rows="3" name="impact" id="analysis-form-impact" placeholder="故障影响" style="resize:vertical;"></textarea>
                </div>
            </div>
            <div class="form-group">
                <label for="analysis-form-impact-severity" class="col-sm-2 control-label">影响严重性A</label>
                <div class="col-sm-2">
                  <select class="form-control" name="severity" id="analysis-form-impact-severity">
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    </select>
                </div>
                <label class="col-sm-1 control-label">&times;</label>
                <label for="analysis-form-impact-probability" class="col-sm-2 control-label">故障发生概率B</label>
                <div class="col-sm-2">
                  <select class="form-control" name="probability" id="analysis-form-impact-probability">
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    </select>
                </div>
                <label class="col-sm-1 control-label">=</label>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label">风险水平</label>
                <label class="col-sm-2 control-label">6</label>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label">风险分级</label>
                <label class="col-sm-2 control-label">高 RL >= 6</label>
            </div>
            <div class="form-group">
                <label for="analysis-form-solution" class="col-sm-2 control-label">风险减缓与防范措施</label>
                <div class="col-sm-10">
                    <textarea class="form-control" rows="3" name="solution" id="analysis-form-solution" placeholder="风险减缓与防范措施" style="resize:vertical;"></textarea>
                </div>
            </div>
            <div class="form-group">
                <label for="analysis-form-solution-efficiency" class="col-sm-2 control-label">措施后风险减缓值</label>
                <div class="col-sm-2">
                  <select class="form-control" name="efficiency" id="analysis-form-solution-efficiency">
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    </select>
                </div>
            </div>
            <div class="form-group" id="file-1">
                <label for="analysis-form-file-1" class="col-sm-2 control-label">相关文件名称</label>
                <div class="col-sm-9">
                  <input class="form-control" name="file-1" id="analysis-form-file-1" placeholder="文件名称">
                </div>
                <div class="col-sm-1">
                  <a href="#" style="color:black;text-decoration:none;font-size:25px;line-height:25px;" onclick="handleAddFile(1);return false;">&plus;</a>
                </div>
            </div>
            <!-- <div class="form-group">
                <label for="analysis-form-file-2" class="col-sm-2 control-label">相关文件1</label>
                <div class="col-sm-9">
                  <input class="form-control" name="file-2" id="analysis-form-file-2" placeholder="文件1">
                </div>
                <div class="col-sm-1" style="padding:0;">
                  <a href="" style="color:black;text-decoration:none;font-size:25px;line-height:25px;margin-right:10px;" onclick="handleRemoveFile(2);return false;">&times;</a>
                  <a href="" style="color:black;text-decoration:none;font-size:25px;line-height:25px;" onclick="handleAddFile(2);return false;">&plus;</a>
                </div>
            </div> -->
        </form>
      </div>
    </div>

    <!-- 全局变量存储文件数目 js 代码 -->
    <script type="text/javascript">
      var numOfFiles = 1;
    </script>

    <!-- 事件处理器代码 -->
    <script type="text/javascript">
        function handleSubmit() {
            // TODO: 处理表单数据并提交
            document.getElementById("rs-info-form").submit();
        }

        function handleDelete() {
          var r = confirm('确认删除？');
          if (r) {
            // TODO: 删除数据库信息
            // TODO: 删除模板数据
            // TODO: 删除条目并返回
            handleReturn()
          }
        }

        function handleReturn() {
          // TODO: 取消提交，返回页面
          location.href = './home.html';
        }

        function removeItem(context, formId) {
          var r = confirm('确认删除？');
          if (r) {
            $('#' + formId).remove();
            // TODO: 删除数据库信息
            // TODO: 删除模板数据
          }
        }

        function handleRemoveFile(fileId) {
          $('#file-' + fileId).remove()
        }

        function handleAddFile(fileId) {
          var newFileId = ++numOfFiles;
          var newHtml = generateMockDOM(newFileId);
          console.log($('#file-' + fileId).after(newHtml));
        }

        // 此方法仅生成 UI 伪 DOM
        function generateMockDOM(fileId) {

          var label = '<label for="analysis-form-file-' + fileId + '" class="col-sm-2 control-label">相关文件名称</label>';
          var input = '<input class="form-control" name="file-' + fileId + '" id="analysis-form-file-' + fileId + '" placeholder="文件名称">';

          var newHtml = '<div class="form-group" id="file-' + fileId + '">' + label + '<div class="col-sm-9">' + input + '</div><div class="col-sm-1" style="padding:0;"><a href="" style="color:black;text-decoration:none;font-size:25px;line-height:25px;margin-right:10px;" onclick="handleRemoveFile(' + fileId + ');return false;">&times;</a><a href="" style="color:black;text-decoration:none;font-size:25px;line-height:25px;" onclick="handleAddFile(' + fileId + ');return false;">&plus;</a></div></div>'

          return newHtml;
        }
    </script>

</body>

</html>
